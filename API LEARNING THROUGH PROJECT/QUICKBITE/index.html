<!DOCTYPE html>
<html>
<head>
    <title>QuickBite - Order Food</title>
</head>
<body>

    <h1>üçî QuickBite Restaurant</h1>

    <!-- Order Form -->
    <h3>Place Order</h3>

    <input type="text" id="customer_name" placeholder="Your Name">
    <br><br>

    <input type="text" id="item" placeholder="Food Item">
    <br><br>

    <input type="number" id="quantity" placeholder="Quantity">
    <br><br>

    <button onclick="placeOrder()">Place Order</button>

    <hr>

    <!-- Orders List -->
    <h3>üì¶ Order History</h3>
    <button onclick="fetchOrders()">Fetch Orders</button>

    <ul id="orders_list"></ul>


    <h3>Login</h3>
<input type="text" id="username" placeholder="Username">
<input type="password" id="password" placeholder="Password">
<button onclick="login()">Login</button>

<script>
let authToken = null;

function login() {
    console.log("CLIENT: Login clicked");

    fetch("http://127.0.0.1:5000/login", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            username: document.getElementById("username").value,
            password: document.getElementById("password").value
        })
    })
    .then(res => res.json())
    .then(data => {
        authToken = data.token;
        console.log("CLIENT: Token received", authToken);
        alert("Logged in successfully");
    });
}
</script>


    <script>
        console.log("STEP 1: Frontend loaded");

        const API_URL = "http://127.0.0.1:5000/orders";
        console.log("STEP 2: API URL set:", API_URL);

        // ----------------------------
        // PLACE ORDER (POST REQUEST)
        // ----------------------------
        function placeOrder() {
            console.log("\nCLIENT ACTION: Place Order clicked");

            // Read input values
            const customerName = document.getElementById("customer_name").value;
            const item = document.getElementById("item").value;
            const quantity = document.getElementById("quantity").value;

            console.log("STEP 3: Form data collected", {
                customerName, item, quantity
            });

            // Create payload
            const orderData = {
                customer_name: customerName,
                item: item,
                quantity: Number(quantity)
            };

            console.log("STEP 4: Payload prepared", orderData);

            // Send POST request
            fetch(API_URL, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + authToken
                },
                body: JSON.stringify(orderData)
            })
            .then(response => {
                console.log("STEP 5: Server responded to POST");
                return response.json();
            })
            .then(data => {
                console.log("STEP 6: Order created successfully", data);
                alert("Order placed!");
            })
            .catch(error => {
                console.error("ERROR placing order:", error);
            });
        }
        // Validate input
        if (!customerName || !item || quantity <= 0) {
            alert("Please enter valid order details");
            return;
        }

        // ----------------------------
        // FETCH ORDERS (GET REQUEST)
        // ----------------------------
        function fetchOrders() {
            console.log("\nCLIENT ACTION: Fetch Orders clicked");

            fetch(API_URL)
                .then(response => {
                    console.log("STEP 7: Server responded to GET");
                    return response.json();
                })
                .then(data => {
                    console.log("STEP 8: Orders received", data);

                    const list = document.getElementById("orders_list");
                    list.innerHTML = "";

                    data.forEach(order => {
                        const li = document.createElement("li");
                        li.innerText = `${order.customer_name} ordered ${order.quantity} ${order.item}`;
                        list.appendChild(li);
                    });

                    console.log("STEP 9: Orders rendered on UI");
                })
                .catch(error => {
                    console.error("ERROR fetching orders:", error);
                });
        }
    </script>

</body>
</html>
comment
<!--
üî• FULL REQUEST‚ÄìRESPONSE FLOW (READ THIS CAREFULLY)
üßç Customer clicks Place Order
Frontend
 ‚Üí POST /orders
 ‚Üí JSON body sent

üñ• Flask backend prints:
NEW REQUEST: POST /orders
STEP 1: Data received
STEP 2: Order object created
STEP 3: Order saved

üßç Customer clicks Fetch Orders
Frontend
 ‚Üí GET /orders
-->